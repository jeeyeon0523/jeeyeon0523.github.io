---
layout: post
title: SQL을 사용할 수 있는 방법
subtitle: ORM에 대한 스터디를 중심으로!
categories: study
tags: [sqlMapper, orm, database]
---

웹알못 비전공자가 입사하고 프로젝트 환경에 툭 내던지며 귀동냥, 어깨너머로 웹을 배워간지 어언 4년차...
"원래 그래야 하는 건가보다" / "원래 이렇게 쓰는건가보다" 라고 생각하고 의심이나 궁금증을 가지고 있지 않았던 내용을 대충이나마 짚고 넘어가보자.

이번 프로젝트에서 처음으로 ORM의 개념을 익히고 사용하게 되었는데,
또 남이 짜놓은 코드를 눈치껏 복붙복붙하는게 아니라 도대체 요게 뭐고 나는 지금 뭘 하고 있는건지 정리해보려고 한다.

++ 이번 포스팅에서는 현님 블로그에서 봤던 것처럼 '손으로 그려서 설명하기' 기법을 손민수해보겠다.

## 웹개발 환경과 데이터베이스

우리가 지금까지 통상적으로 아는 웹 인프라의 구성요소는 크게 이와 같다.
(실제 서비스를 위해서는 물론 이보다 더 많은 구성요소가 필요하지만 여기서는 생략한다.)

![KakaoTalk_Photo_2022-10-05-23-16-41 001](https://user-images.githubusercontent.com/47856202/194083508-bd04c2de-a77b-477f-a10a-a6e7fc92d68f.png)

오늘은 이 Database 부분에 살짝 집중해 볼건데,
본질적인 질문을 해보자.

**"왜 웹 개발을 하기 위해서는 Database가 필요한가?"**
: 당연히 데이터를 저장하기 위해서!

**"데이터를 저장한다는 것음 무엇을 의미하는가?"**
: 데이터의 영속성을 보장한다는 뜻이다!

## 데이터의 영속성

_데이터의 영속성이란, 데이터를 생성한 프로그램이 종료되더라도 사라지지 않는 데이터의 특성을 말한다._

![KakaoTalk_Photo_2022-10-05-23-16-41 002](https://user-images.githubusercontent.com/47856202/194083557-2163ae52-6ac7-4898-9d54-1382b4787900.png)

영속성을 갖지 않는 데이터는 단지 메모리 위에서만 존재하므로, 프로그램을 종료하면 모두 잃어버리게 된다.
그렇다. 이 모든건 데이터의 영속성을 보장하기 위해 시작된 것이다.

## 데이터의 영속성을 지키기 위해?

데이터베이스에 데이터를 저장하기 위한 방법에는 여러가지가 있지만,
그 중 내가 경험해봤던 방법을 중심으로 설명해보자면

![KakaoTalk_Photo_2022-10-05-23-16-42 003](https://user-images.githubusercontent.com/47856202/194083577-e8f3072b-cc8a-4342-bdee-4e1a7347d317.png)

**jdbc(Java Database Connectivity)**

입사하고 교육받을 때 사용해봄. (java에서 사용)

**Spring JDBC**

아마도 이 중 jdbcTemplate이었던 것 같은데, 공공프로젝트를 할 때 사용해봤음. 사실 이제 기억이 가물가물함.

**Persistent Framework**

현재 내가 사용중이고, 사용해봤고, 사용법이 기억나는 범주 안에서 내가 쓸 수 있는 기술셋은 모두 여기에 속함.

## Persistent Framwork!

![KakaoTalk_Photo_2022-10-05-23-16-42 004](https://user-images.githubusercontent.com/47856202/194083663-091b1ac8-0e06-431f-bdd4-303de1bbec5a.png)

Persistent Framework는 크게 두가지로 나뉜다.

- SQL Mapper
- ORM

### 1. SQL Mapper

지금까지 사용해본 SQL Mapper는 Mybatis가 전부인데,
ORM의 개념을 알기 전까지 Mybatis가 내 삶의 전부였다.
(사실 위에서 언급한 jdbcTemplate이 이 범주에 속하긴 하지만, 이제 기억이 안나므로 패스한다.)

![KakaoTalk_Photo_2022-10-05-23-16-42 005](https://user-images.githubusercontent.com/47856202/194083755-fe9b4015-186f-4a37-b5e7-8c91f2b377ee.png)

#### 내가 느낀바의 SQL Mapper (=Mybatis)의 장단점

**장점**

- (내 입장에서는) ORM보다 가독성이 높고, 목적이 명확하게 보인다.
- 세세한 쿼리문 조절, 수정등 sql문을 컨트롤(?) 하고 싶을 때 편하다.
- 익숙하다.

**단점**

- 한 두줄의 간단한 쿼리도 직접 다 작성해줘야할 때 귀찮다.
- DBMS 변경 시에 대공사가 필요하다 <- 사실 이건 경험해본적이 없다.

### 2. ORM (Object-Relational Mapping : 객체-관계 매핑)

객체와 관계형 데이터베이스의 데이터를 자동으로 매핑해 주는 것을 말한다.
ORM을 통해 객체들의 관계를 바탕으로 SQL 쿼리문을 **자동으로!** 생성해준다.

#### 내가 느낀바의 ORM (=JPA)의 장단점

**장점**

- 잘 만들어진 엔터티만으로 원하는 쿼리를 뿅뿅 사용할 수가 있다. (별 로직 아닌데도, 꼭 필요하게 가져와야하는 자잘한 쿼리들을 함수명(?)처럼 사용하는 것만으로도 쿼리가 완성된다!)
- 자바에서 사용하는 경우, equals 같은 자바의 기능을 같이 쓸 수 있다.
- DBMS 종속성이 덜하다. <- 물론 이것도 체감/경험 해본적 없다.

**단점**

- 러닝커브가 존재한다. (=사용하기가 어렵다.) 이건 아직 익숙하지 않아서 그럴수도 있긴 하겠지만, ORM의 개념을 깨치는 것 부터 사용방법을 익히는데 까지 시간이 좀 걸린다. (난 아직도 어버버하는 와중이라 얼마전에도 레오님이 일대일로 과외하듯 쿼리 수정해준건 안비밀이다...(QueryDsl))
- 쿼리를 세세하게 조절하는게 어렵다.

## JPA (JAVA Persistent API)

Java에서 ORM을 사용하기 위한 표준 인터페이스들을 모아놓은 것들이다.
JPA는 다음과 같은 세가지 요소로 구성된다.

**jpa 패키지의 API 그 자체...? , JPQL, 객체/관계 메타데이터**

![KakaoTalk_Photo_2022-10-05-23-16-42 005](https://user-images.githubusercontent.com/47856202/194083755-fe9b4015-186f-4a37-b5e7-8c91f2b377ee.png)

_jpa api 를 사용하면 객체/관계 메타데이터를 이용해 jpql 쿼리를 자동으로 만들어 낸다._

물론 @Query 어노테이션을 이용해 JPQL 쿼리를 직접 작성할 수도 있다.

JPA api 사용법이나, jpql 쿼리 작성에 대한 세세한 내용은 다른 블로그 글을 참조하자!!! (설명할만치 잘 모름.)

### ORM Framework : Hibernate

Hibernate는 JPA의 구현체 중 하나이다.

JPA 구현체 즉, ORM Framework에는 Hibernate 말고도 OpenJPA, EclipseLink 등등 여러가지가 존재하는데
수 많은 구글링 결과를 보고 있노라면, 아마 JPA~>Hibernate 이 두개가 짝꿍처럼 사용되는 게 관용적인 기술셋인 것 같다.

이 단계를 설명하는데 있어서 사실 지금 조금 문제가 있는게,

JPA와 JPA 구현체(=ORM Framework, Hibernate)의 개념을 딱 명확하게 구분지어서 이해하기 힘든 와중이다.

ORM은 JPA로만, JPA는 Hibernate로만 경험을 하다보니 머리속에서 개념이 짬뽕되고 있는 중.

처음 Java를 Spring 프레임워크를 통해 배우다보니, Java == Spring 이라고 생각하던 개발 뉴비의 시절의 있었는데,
그때와 약간 비슷한 느낌이 난다. 요새 새로운 기술을 책이나 이론보다는 프로젝트에서 실제 코드를 통해 먼저 뚜와앗!하고 경험하다보니 이럴 때마다 프레임워크는 똑 떼고 온전히 기술만을 체감으로 이해하는 게 아직 잘 안되는것 같다!

위와 같은 사유로 요건 이정도 까지 하고 넘어가도록 하자!

![KakaoTalk_Photo_2022-10-05-23-16-42 006](https://user-images.githubusercontent.com/47856202/194083813-9f526592-5013-47df-b593-6e7bfa44e67b.png)

## 추가: QueryDsl

jpa의 기본 쿼리 메소드로는 만족스럽지 않을 때! -> JPQL로 직접 쿼리를 작성할 수 있는데
이 때, JPQL 쿼리를 문자열이 아닌 코드로 쿼리를 작성할 수 있게 해주는 프레임워크가 QueryDsl이다.

코드로 쿼리를 작성하므로, 컴파일 시점에 문법 오류를 잡을 수 있고, 동적쿼리 작성이 편하다는 장점이 있다!!
물론 사용방법을 배우는 러닝커브가 필요하며, 나는 아직 QueryDsl로 짜여진 코드가 길면, 읽고 이해하는데 조금 시간이 걸린다.

어쨌든, Spring + JPA + QueryDsl 요 세트가 요즘 표준인듯!!!

![KakaoTalk_Photo_2022-10-05-23-16-42 007](https://user-images.githubusercontent.com/47856202/194083855-5ddd49d6-9062-49c8-bcbb-d0b730636d90.png)

## 참고한 글

> https://gmlwjd9405.github.io/2019/02/01/orm.html
>
> https://gmlwjd9405.github.io/2018/12/25/difference-jdbc-jpa-mybatis.html
>
> https://ict-nroo.tistory.com/117
